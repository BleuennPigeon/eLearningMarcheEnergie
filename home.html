<!doctype html>
<html lang="fr-FR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cours en énergies renouvelables</title>
  <link rel="stylesheet" href="style/home.css" />
</head>

<!-- Verrouillage des modules et QCM-->
<script>
  const TOTAL_MODULES = 6;

  // --- Banque de QCM : 1 QCM par module ---
  // correct = index de la bonne réponse (0,1,2,...)
  // pass = X bonnes réponses minimum pour valider le module
  const QCM_BY_MODULE = {
    1: {
      title: "Quiz - Module 0",
      pass: 2,
      questions: [
        { q: "Une facture d'électricité dépend principalement :", a: ["Du soleil", "De la consommation (kWh)", "De la couleur du compteur"], correct: 1 },
        { q: "Le kWh correspond à :", a: ["Une puissance", "Une énergie", "Une tension"], correct: 1 },
        { q: "Le prix peut varier selon :", a: ["L'offre/contrat", "La taille du frigo", "La météo uniquement"], correct: 0 }
      ]
    },
    2: {
      title: "Quiz - Module 1",
      pass: 2,
      questions: [
        { q: "La puissance souscrite s'exprime généralement en :", a: ["kVA", "kWh", "€"], correct: 0 },
        { q: "Le TURPE correspond :", a: ["À une taxe", "Au tarif d’acheminement", "À un type de panneau solaire"], correct: 1 },
        { q: "Le kWh sur la facture représente :", a: ["L'énergie consommée", "La puissance maximale", "La fréquence"], correct: 0 }
      ]
    },
    3: {
      title: "Quiz - Module 2",
      pass: 2,
      questions: [
        { q: "Le marché de l’électricité inclut :", a: ["Production, transport, distribution, fourniture", "Uniquement la production", "Uniquement la distribution"], correct: 0 },
        { q: "RTE est associé plutôt à :", a: ["Transport (réseau haute tension)", "Fourniture", "Production nucléaire"], correct: 0 },
        { q: "Les prix spot se forment :", a: ["Sur un marché de court terme", "Une fois par an", "Par tirage au sort"], correct: 0 }
      ]
    },
    4: {
      title: "Quiz - Module 3",
      pass: 2,
      questions: [
        { q: "Réduire la puissance souscrite permet :", a: ["De baisser l’abonnement", "De baisser automatiquement la consommation", "De produire plus"], correct: 0 },
        { q: "Un dépassement de puissance peut causer :", a: ["Des coupures/délestage", "Plus de soleil", "Une hausse de tension permanente"], correct: 0 },
        { q: "Optimiser la consommation, c’est :", a: ["Déplacer certains usages", "Toujours consommer plus la nuit", "Changer de couleur de câble"], correct: 0 }
      ]
    },
    5: {
      title: "Quiz - Module 4",
      pass: 2,
      questions: [
        { q: "L’autoconsommation signifie :", a: ["Consommer sa propre production", "Revendre toute sa production", "Ne plus être raccordé au réseau"], correct: 0 },
        { q: "Une énergie renouvelable :", a: ["Se renouvelle à l’échelle humaine", "Est toujours gratuite", "N’a aucun impact"], correct: 0 },
        { q: "Un onduleur sert à :", a: ["Convertir DC en AC", "Stocker l’énergie", "Augmenter la fréquence"], correct: 0 }
      ]
    },
    6: {
      title: "Quiz - Module 5",
      pass: 2,
      questions: [
        { q: "Un contrat à prix fixe :", a: ["Stabilise le prix sur une durée", "Change toutes les heures", "Dépend du vent"], correct: 0 },
        { q: "La gestion du risque vise à :", a: ["Réduire l’exposition aux variations", "Augmenter l’incertitude", "Éviter de suivre les prix"], correct: 0 },
        { q: "Un prix indexé peut :", a: ["Suivre un marché/indice", "Être toujours plus bas", "Être illégal"], correct: 0 }
      ]
    }
  };

  // --- Verrouillage des modules ---
  document.addEventListener("DOMContentLoaded", () => {
    const completed = parseInt(localStorage.getItem("moduleCompleted") || "0", 10);

    for (let i = 1; i <= TOTAL_MODULES; i++) {
      const lessons = document.querySelector(`.lessons[data-module="${i}"]`);
      if (!lessons) continue;

      if (i > completed + 1) {
        lessons.classList.add("locked");
      } else {
        lessons.classList.remove("locked");
      }
    }
    updateCertificationUI();
  });

  // --- État courant du QCM affiché ---
  let currentModule = null;

  function openQcm(moduleNumber) {
    currentModule = moduleNumber;

    const qcm = QCM_BY_MODULE[moduleNumber];
    if (!qcm) {
      alert("Aucun QCM défini pour ce module.");
      return;
    }

    document.getElementById("qcmTitle").textContent = qcm.title;
    document.getElementById("qcmSubtitle").textContent =
      `Réussite : au moins ${qcm.pass} bonne(s) réponse(s) sur ${qcm.questions.length}.`;

    const form = document.getElementById("qcmForm");
    form.innerHTML = "";

    qcm.questions.forEach((item, idx) => {
      const fieldset = document.createElement("fieldset");
      fieldset.className = "question";

      const legend = document.createElement("legend");
      legend.textContent = `${idx + 1}. ${item.q}`;
      fieldset.appendChild(legend);

      item.a.forEach((choice, cIdx) => {
        const label = document.createElement("label");
        label.innerHTML = `
          <input type="radio" name="q${idx}" value="${cIdx}">
          ${choice}
        `;
        fieldset.appendChild(label);
      });

      form.appendChild(fieldset);
    });

    const result = document.getElementById("qcmResult");
    result.textContent = "";
    result.className = "qcm-result";

    const modal = document.getElementById("qcmModal");
    modal.classList.add("show");
    modal.setAttribute("aria-hidden", "false");
  }

  function closeQcm() {
    currentModule = null;
    const modal = document.getElementById("qcmModal");
    modal.classList.remove("show");
    modal.setAttribute("aria-hidden", "true");
  }

  function submitQcm() {
    if (!currentModule) return;

    const qcm = QCM_BY_MODULE[currentModule];
    const form = document.getElementById("qcmForm");
    const result = document.getElementById("qcmResult");

    let score = 0;
    let answered = 0;

    qcm.questions.forEach((item, idx) => {
      const picked = form.querySelector(`input[name="q${idx}"]:checked`);
      if (picked) {
        answered++;
        if (parseInt(picked.value, 10) === item.correct) score++;
      }
    });

    // exiger que tout soit répondu
    if (answered < qcm.questions.length) {
      result.textContent = "Réponds à toutes les questions avant de valider.";
      result.className = "qcm-result ko";
      return;
    }

    if (score >= qcm.pass) {
      result.textContent = `✅ Bravo ! Score: ${score}/${qcm.questions.length}. Module validé.`;
      result.className = "qcm-result ok";

      // On valide le module
      localStorage.setItem("moduleCompleted", String(currentModule));

      //validation de tous les modules deverouille la certification
      if (currentModule === TOTAL_MODULES) {
        localStorage.setItem("certUnlocked", "1");
      }

      // On ferme puis refresh pour déverrouiller le suivant
      setTimeout(() => {
        closeQcm();
        location.reload();
      }, 600);
    } else {
      result.textContent = `❌ Score insuffisant: ${score}/${qcm.questions.length}. Minimum: ${qcm.pass}.`;
      result.className = "qcm-result ko";
    }
  }

  // Optionnel: fermer au clavier (ESC)
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") closeQcm();
  });

function updateCertificationUI() {
  const unlocked = localStorage.getItem("certUnlocked") === "1";
  const section = document.getElementById("certSection");
  if (!section) return;

  section.hidden = !unlocked;
}

function openCertificate() {
  const unlocked = localStorage.getItem("certUnlocked") === "1";
  if (!unlocked) return;

  window.location.href = "certificat.html";
}

//Reset la progression
function resetProgressDemo() {
  localStorage.removeItem("moduleCompleted");
  localStorage.removeItem("certUnlocked");
  localStorage.removeItem("certRef");
  localStorage.removeItem("certFirstName");
  localStorage.removeItem("certLastName");
  location.reload();
}


</script>


<!-- POPUP QCM (Modal) -->
<div id="qcmModal" class="modal" aria-hidden="true">
  <div class="modal-backdrop" onclick="closeQcm()"></div>

  <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="qcmTitle">
    <h3 id="qcmTitle">Quiz de validation</h3>
    <p id="qcmSubtitle"></p>

    <div class="modal-body">
        <form id="qcmForm"></form>
      </div>

    <div class="modal-actions">
      <button type="button" class="btn" onclick="closeQcm()">Annuler</button>
      <button type="button" class="btn primary" onclick="submitQcm()">Valider</button>
    </div>

    <p id="qcmResult" class="qcm-result"></p>
  </div>
</div>

<body>
  <!-- HEADER -->
  <header class="site-header">
    <div class="header-inner">
      <div class="brand">
        <div class="logo"></div>
        <div class="brand-text-left">
          <div class="brand-small">Cahier des</div>
          <div class="brand-small">transitions</div>
        </div>

        <div class="brand-text-right">
          <span class="brand-big"><span class="brand-d">D</span>EMAIN</span>
          <span class="brand-big"><span class="brand-a">A</span>UTREMENT</span>
        </div>
      </div>

      <nav class="nav">
        <a href="#">Parcourir le contenu</a>
        <a href="#">Transition énergétique</a>
        <a href="#">Transition Numérique</a>
        <a href="#">Partenaires</a>
        <a href="#">Produits recommandés</a>
        <a href="#">À propos</a>
      </nav>
    </div>
  </header>

  <!-- PAGE -->
  <main class="page">
    <div class="layout">

      <!-- CONTENU -->
      <section class="content-card">
        <div class="course-banner">COURS CULTURE ENERGIE & OPTIMISATION</div>

        <div class="content">
          <p>
            Ces modules de cours sur le marché de l'énergie sont enseignés et proposés par :
            Dr.Dhaker ABBES.
          </p>

          <h3 class="module-title" data-module="1">MODULE 0 : Introduction du marché de l'énergie</h3>
          <ul class="lessons" data-module="1">
            <li><a href="#">Leçon</a></li>
            <li><a href="#">Video</a></li>
            <li><a href="#">Etude de cas</a></li>
            <li><a href="#">Etude de cas corrigée</a></li>
            <button type="button" onclick="openQcm(1)">Module terminé</button>
          </ul>

          <h3 class="module-title" data-module="2">MODULE 1 : Lire et comprendre sa facture d'électricité</h3>
          <ul class="lessons" data-module="2">
            <li><a href="module1/DiapoCours1.pptx" download>Leçon</a></li>
            <li><a href="module1/Vidéo facture d'électricité.mp4" download>Video</a></li>
            <li><a href="module1/factureQCM.html" target="_blank">Facture interactive</a></li>
            <button type="button" onclick="openQcm(2)">Module terminé</button>
          </ul>

          <h3 class="module-title" data-module="3">MODULE 2 : Fonctionnement du marché de l'électricité</h3>
          <ul class="lessons" data-module="3">
            <li><a href="#">Leçon</a></li>
            <li><a href="#">Video</a></li>
            <li><a href="#">Etude de cas</a></li>
            <li><a href="#">Etude de cas corrigée</a></li>
            <button type="button" onclick="openQcm(3)">Module terminé</button>
          </ul>

          <h3 class="module-title" data-module="4">MODULE 3 : Optimiser la consommation et la puissance souscrite</h3>
          <ul class="lessons" data-module="4">
            <li><a href="#">Leçon</a></li>
            <li><a href="#">Video</a></li>
            <li><a href="#">Etude de cas</a></li>
            <li><a href="#">Etude de cas corrigée</a></li>
            <button type="button" onclick="openQcm(4)">Module terminé</button>
          </ul>

          <h3 class="module-title" data-module="5">MODULE 4 : Autoconsommation et renouvelables</h3>
          <ul class="lessons" data-module="5">
            <li><a href="#">Leçon</a></li>
            <li><a href="#">Video</a></li>
            <li><a href="#">Etude de cas</a></li>
            <li><a href="#">Etude de cas corrigée</a></li>
            <button type="button" onclick="openQcm(5)">Module terminé</button>
          </ul>

          <h3 class="module-title" data-module="6">MODULE 5 : Stratégie d'achat et gestion du risque</h3>
          <ul class="lessons" data-module="6">
            <li><a href="#">Leçon</a></li>
            <li><a href="#">Video</a></li>
            <li><a href="#">Etude de cas</a></li>
            <li><a href="#">Etude de cas corrigée</a></li>
            <button type="button" onclick="openQcm(6)">Module terminé</button>
          </ul>
        </div>
      </section>

      <!-- CERTIFICATION (cachée tant que tous les modules ne sont pas validé) -->
<section id="certSection" class="cert-section" hidden>
  <h3>Certification</h3>
  <p>
    Bravo, vous avez terminé la formation.
    Vous pouvez maintenant générer votre certificat.
  </p>

    <button
      type="button"
      class="btn primary"
      onclick="openCertificate()"
    >
      Ouvrir mon certificat
    </button>

  <p class="cert-hint">
    Le certificat s’ouvre dans une page dédiée, optimisée pour l’impression A4
    et l’export PDF.
  </p>
</section>



      
      <!-- SIDEBAR -->
      <aside class="sidebar">
        <div class="support-box">
          <div class="support-pill">Support</div>
          <p class="support-text">Ce site vous est utile ?</p>
          <p class="support-text"><strong>Un don pour le soutenir</strong></p>
        </div>

        <button type="button" class="btn" onclick="resetProgressDemo()">
           Réinitialiser la progression (démo)
        </button>

      </aside>

    </div>
  </main>

</body>
</html>
